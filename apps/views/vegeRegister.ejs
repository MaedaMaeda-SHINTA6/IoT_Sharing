<!--
 * Start Bootstrap - Agency v3.3.7+1 (http://startbootstrap.com/template-overviews/agency)
 * Copyright 2013-2016 Start Bootstrap
 * Licensed under MIT (https://github.com/BlackrockDigital/startbootstrap/blob/gh-pages/LICENSE)
-->
<!-- Copyright FUJITSU LIMITED 2016-2017 -->
<!DOCTYPE html>
<html lang="jp">
<html>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

<head>
    <title>
        <%- t('title_vegeRegister') %>
    </title>
    <!-- Bootstrap Core CSS -->
    <link href="/stylesheets/bootstrap.min.css" rel="stylesheet">
    <link href="/stylesheets/jquery-ui.min.css" rel="stylesheet" />
    <link href="http://ajax.googleapis.com/ajax/libs/jqueryui/1/themes/redmond/jquery-ui.css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link href="/stylesheets/sharingBusinessDemo.css" rel="stylesheet">
    <link href="/stylesheets/custom/home.css" rel="stylesheet">
    <link href="/stylesheets/custom/gmaps.css" rel="stylesheet">
    <link href="/stylesheets/custom/imagePreview.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <!--link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">-->
    <link href="/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
    <link href='https://fonts.googleapis.com/css?family=Kaushan+Script' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='https://fonts.googleapis.com/css?family=Roboto+Slab:400,100,300,700' rel='stylesheet' type='text/css'>


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body id="page-top" class="index">
    <header>
        <%- include('_layout/header',{param:param}) -%>
    </header>

    <main role="main" class="container">
        <!-- タイトル -->
        <div class="text-center mt-5">
            <h3>農作物プロフィール</h3>
        </div>

        <div id="form-register">
            <form action="/vege-register" method="post" enctype="multipart/form-data">
                <!--<form action="/vege-register/uploads" method="post" enctype="multipart/form-data">-->
                <!--<input type="file" name="file_uploads">
                    <input type="submit" value="画像テスト">-->

                <div class="container">
                    <div class="row">
                        <div class="col">
                            <div class="imagePreview"></div>
                            <div class="input-group">
                                <label class="input-group-btn">
                                    <span class="btn btn-primary">
                                        写真を選択してください
                                        <input type="file" name="file_uploads" style="display:none" class="form-control">
                                    </span>
                                </label>
                                <input type="text" class="form-control" readonly="">
                                <!--<input type="submit" value="画像登録">-->

                            </div>
                        </div>
                    </div>
                    <!-- </form> -->


                    <!--野菜情報-->

                    <div class="row">
                        <div class="col">作物名</div>
                        <div class="col">
                            <input type="text" name="vege_variety_name" class="form-control" />
                        </div>
                        <div class="w-100"></div>
                        <div class="col">産地</div>
                        <div class="col">
                            <input type="text" name="vege_location" class="form-control" />
                        </div>
                        <div class="w-100"></div>
                        <div class="col">数量</div>
                        <div class="col">
                            <input type="text" name="vege_quantity" class="form-control" />
                        </div>
                        <div class="w-100"></div>
                        <div class="col">重さ</div>
                        <div class="col">
                            <input type="text" name="vege_gm" class="form-control" />
                        </div>
                        <div class="w-100"></div>
                        <div class="col">しなびLv</div>
                        <div class="col">
                            <input type="text" name="" class="form-control" />
                        </div>
                        <div class="w-100"></div>
                        <div class="col">価格</div>
                        <div class="col">
                            <input type="text" name="vege_price" class="form-control" />
                        </div>
                        <div class="w-100"></div>

                        <div class="col">緯度</div>
                        <div class="col">
                            <input id="lat" type="text" name="delivery_place_latitude" class="form-control" />
                        </div>
                        <div class="w-100"></div>

                        <div class="col">経度</div>
                        <div class="col">
                            <input id="lng" type="text" name="delivery_place_longitude" class="form-control" />
                        </div>
                        <div class="w-100"></div>

                        <div class="col">配送希望日</div>
                        <div class="col">
                            <input type="text" id="delivery_req_day" name="delivery_req_day" class="form-control" placeholder="<%- t('msg_placeholder_select_from_calendar') %>"
                                readonly>
                            <input type="hidden" id="delivery_req_day_d" name="delivery_req_day_d" class="form-control">
                        </div>
                        <div class="w-100"></div>

                        <div class="col">配送希望時間</div>
                        <div class="col" style="display:inline-flex;">
                          <select class="form-control" id="sharing_start" name="sharing_start" >
                            <option value="00"><%- t('label_search_period_not_specified_start') %></option>
                            <% var hour = ["00","01","02","03","04","05","06","07","08","09","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"]; %>
                            <% for(var i=0; i<=23; i++ ) { %>
                              <option value=<%= hour[i] %> ><%= hour[i] + t('unit_of_period') %></option>
                            <% } %>
                          </select>
                        </div>
                        <div class="w-100"></div>
                    
                        <div class="col">野菜ステータス</div>
                        <div class="col">
                            <!-- ExtItem取得-->
                            <% for(var i=0; i< vege_state_item.length; i++ ) { %>
                                <div class="checkbox">
                                    <label>
                                        <input type="radio" id="<%= vege_state_item[i].identifier %>" name="<%= vege_state_item[i].identifier %>" value="<%= vege_state_item[i].id %>">
                                        <%= vege_state_item[i].displayName %>
                                    </label>
                                </div>
                                </select>
                                <% } %>

                        </div>
                        <div class="w-100"></div>
                        <div class="col">配送ステータス</div>
                        <div class="col">
                            <!-- ExtItem取得-->
                            <% for(var i=0; i< delivery_vega_state_item.length; i++ ) { %>
                                <div class="radio">
                                    <input type="radio" name="<%= delivery_vega_state_item[i].identifier %>" id="<%= delivery_vega_state_item[i].identifier+i %>"
                                        value=<%=delivery_vega_state_item[i].id %> >
                                    <%= delivery_vega_state_item[i].displayName %>
                                </div>
                                <% } %>
                        </div>

                    </div>
                </div>
                <input type="hidden" name="farmer_name" value="<%= farmer_name %>" />
                <input type="hidden" name="farmer_id" value="<%= farmer_id %>" />

                <button type="submit" class="btn btn-primary mb-2 btn-lg btn-block">登録</button>

            </form>

        </div>



        <br>


    </main>


    <%- include('_layout/footer') -%>

        <!-- jQuery -->
        <script src="/javascripts/jquery.js"></script>
        <!-- Portfolio Modals -->
        <!-- Use the modals below to showcase details about your portfolio projects! -->

        <!-- Placed at the end of the document so the pages load faster -->
        <script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60=" crossorigin="anonymous"></script>
        <script>window.jQuery || document.write('<script src="./assets/js/vendor/jquery-slim.min.js"><\/script>')</script>
        <script src="./assets/js/vendor/popper.min.js"></script>
        <script src="/javascripts/bootstrap.min.js"></script>

        <!-- Plugin JavaScript -->
        <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
        <script src="/javascripts/jquery-ui.min.js"></script>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/i18n/jquery-ui-i18n.min.js"></script>
        <script src="/javascripts/demo.js"></script>

        <script type="text/javascript">
            $(function () {
                $.datepicker.setDefaults( $.datepicker.regional[ <%-JSON.stringify(i18n.language) %> ] );
                $('#delivery_req_day').datepicker({
                    minDate: '0y',
                    maxDate: '+1y',
                    //changeMonth: true,
                    dateFormat: 'yy/mm/dd',
                    onSelect: function (selectedDate) {
                        console.log(selectedDate);
                        var today = new Date();
                        var selDate = new Date(selectedDate);
                        var msDiff = selDate.getTime() - today.getTime();
                        nx = Math.floor(msDiff / (1000 * 60 * 60 * 24));
                        nx = nx + 1;
                        var min = '+' + nx + 'd';
                        // $("#sharing_end").datepicker("option", "minDate", min);
                    },
                    beforeShowDay: function (date) {
                        var now = new Date();
                        var base = new Date();
                        base.setDate(now.getDate() - 1);
                        var dateStr = createDateStr(date);

                        if (date.getTime() < base.getTime()) {
                            return [false];
                        }
                        else {
                            return [true];
                        }
                    },
                    onClose: function (datetext, inst) {
                        console.log(datetext);
                        date = datetext.replace(/\u002f/g, "-");
                        date = date + "T00:00:00.000Z";
                        console.log(date);
                        $("#delivery_req_day_d").val(date);
                    }
                });

                // $('#sharing_end').datepicker({
                //     minDate: '0y',
                //     maxDate: '+1y',
                //     //changeMonth: true,
                //     dateFormat: 'yy/mm/dd',

                //     onClose: function (datetext, inst) {
                //         date = datetext.replace(/\u002f/g, "");

                //         $("#hidden_to").val(date);
                //     },
                //     beforeShowDay: function (date) {
                //         var now = new Date();
                //         var base = new Date();
                //         base.setDate(now.getDate() - 1);
                //         var dateStr = createDateStr(date);

                //         if (date.getTime() < base.getTime()) {
                //             return [false];
                //         }
                //         else {
                //             return [true];
                //         }
                //     }

                // });
                function createDateStr(date) {
                    var year = date.getYear();
                    var month = date.getMonth() + 1;
                    var day = date.getDate();
                    if (year < 2000) { year += 1900 };
                    if (month < 10) { month = "0" + month };
                    if (day < 10) { day = "0" + day };

                    var dateStr = year + "/" + month + "/" + day;
                    console.log(dateStr);
                    return dateStr;
                }
            });
        </script>

        <script>
            $(document).on('change', ':file', function () {
                var input = $(this),
                    numFiles = input.get(0).files ? input.get(0).files.length : 1,
                    label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
                input.parent().parent().next(':text').val(label);
                var files = !!this.files ? this.files : [];
                if (!files.length || !window.FileReader) return; // no file selected, or no FileReader support
                if (/^image/.test(files[0].type)) { // only image file
                    var reader = new FileReader(); // instance of the FileReader
                    reader.readAsDataURL(files[0]); // read the local file
                    reader.onloadend = function () { // set image data as background of div
                        input.parent().parent().parent().prev('.imagePreview').css("background-image", "url(" + this.result + ")");
                        input.parent().parent().parent().prev('.imagePreview').css("height", "240px");
                        input.parent().parent().parent().prev('.imagePreview').css("width", "250px");
                    }
                }
            });
        </script>
        <script>
            // 対応している場合
            if (navigator.geolocation) {
                // 現在地を取得
                navigator.geolocation.getCurrentPosition(

                    // [第1引数] 取得に成功した場合の関数
                    function (position) {
                        // 取得したデータの整理
                        var data = position.coords;

                        // データの整理
                        var lat = data.latitude;
                        var lng = data.longitude;
                        var alt = data.altitude;
                        var accLatlng = data.accuracy;
                        var accAlt = data.altitudeAccuracy;
                        var heading = data.heading;			//0=北,90=東,180=南,270=西
                        var speed = data.speed;
                        document.getElementById('lat').value = lat;
                        document.getElementById('lng').value = lng;
                    },

                    // [第2引数] 取得に失敗した場合の関数
                    function (error) {
                        // エラーコード(error.code)の番号
                        // 0:UNKNOWN_ERROR				原因不明のエラー
                        // 1:PERMISSION_DENIED			利用者が位置情報の取得を許可しなかった
                        // 2:POSITION_UNAVAILABLE		電波状況などで位置情報が取得できなかった
                        // 3:TIMEOUT					位置情報の取得に時間がかかり過ぎた…

                        // エラー番号に対応したメッセージ
                        var errorInfo = [
                            "原因不明のエラーが発生しました…。",
                            "位置情報の取得が許可されませんでした…。",
                            "電波状況などで位置情報が取得できませんでした…。",
                            "位置情報の取得に時間がかかり過ぎてタイムアウトしました…。"
                        ];

                        // エラー番号
                        var errorNo = error.code;

                        // エラーメッセージ
                        var errorMessage = "[エラー番号: " + errorNo + "]\n" + errorInfo[errorNo];

                        // アラート表示
                        alert(errorMessage);

                        // HTMLに書き出し
                        document.getElementById("result").innerHTML = errorMessage;
                    },

                    // [第3引数] オプション
                    {
                        "enableHighAccuracy": false,
                        "timeout": 8000,
                        "maximumAge": 2000,
                    }

                );
            }

            // 対応していない場合
            else {
                // エラーメッセージ
                var errorMessage = "お使いの端末は、GeoLacation APIに対応していません。";

                // アラート表示
                alert(errorMessage);

                // HTMLに書き出し
                document.getElementById('result').innerHTML = errorMessage;
            }
        </script>
</body>

</html>